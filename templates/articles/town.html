{% extends "base.html" %}
{% load static easy_thumbnails_tags ad_tags most_read_tags newsletter_tags %}

{% block title %}{{ town.name }} News — {{ settings.site_name }}{% endblock %}
{% block meta_description %}{% if town.description %}{{ town.description }}{% else %}Local news, stories, and community updates from {{ town.name }}, {{ town.get_council_area_display }}.{% endif %}{% endblock %}
{% block og_title %}{{ town.name }} News — {{ settings.site_name }}{% endblock %}
{% block og_description %}{% if town.description %}{{ town.description }}{% else %}Local news, stories, and community updates from {{ town.name }}, {{ town.get_council_area_display }}.{% endif %}{% endblock %}

{% block content %}
<!-- Town Header -->
<section class="section-header">
  <div class="container">
    <span class="section-header__badge">{{ town.get_council_area_display }}</span>
    <h1 class="section-header__title">{{ town.name }}</h1>
    {% if town.description %}
    <p class="section-header__desc">{{ town.description }}</p>
    {% else %}
    <p class="section-header__desc">Local news, stories, and community updates from {{ town.name }}.</p>
    {% endif %}
  </div>
</section>

{% if lead %}
<!-- Lead Story -->
<section class="section">
  <div class="container">
    <div class="lead-story">
      {% include "includes/_featured_card.html" with card=lead is_lead=True %}
    </div>

    {% if secondaries %}
    <div class="secondary-band">
      {% for card in secondaries %}
        {% include "includes/_featured_card.html" with card=card %}
      {% endfor %}
    </div>
    {% endif %}
  </div>
</section>

<!-- Leaderboard Ad -->
<div class="ad-slot ad-slot--leaderboard">
  <span class="ad-slot__label">Advertisement</span>
  <div class="ad-slot__unit" data-slot="leaderboard">
    {% ad_slot "leaderboard" %}
  </div>
</div>

<!-- Main + Rail -->
<section class="section">
  <div class="container">
    <div class="content-rail">
      <div class="content-rail__main">

        {% if articles %}
        <div class="section-grid">
          {% for card in articles %}
            {% include "includes/_article_card.html" with card=card %}
          {% endfor %}
        </div>

        {% if articles.has_other_pages %}
        <nav class="pagination" aria-label="Town pages">
          {% if articles.has_previous %}
          <a href="?page={{ articles.previous_page_number }}" class="pagination__link">Previous</a>
          {% endif %}
          <span class="pagination__info">Page {{ articles.number }} of {{ articles.paginator.num_pages }}</span>
          {% if articles.has_next %}
          <a href="?page={{ articles.next_page_number }}" class="pagination__link">Next</a>
          {% endif %}
        </nav>
        {% endif %}
        {% endif %}
      </div>

      <aside class="content-rail__side">
        <div class="rail-block">
          {% newsletter_signup "rail_primary" %}
        </div>

        <div class="rail-block">
          <h4 class="rail-block__title">Most Read</h4>
          {% most_read "24h" 5 %}
        </div>

        <div class="ad-slot ad-slot--rail">
          <span class="ad-slot__label">Advertisement</span>
          <div class="ad-slot__unit" data-slot="rail-mpu">
            {% ad_slot "rail-mpu" %}
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>
{% else %}
<!-- Empty town — no published articles -->
<section class="section">
  <div class="container">
    <div class="content-rail">
      <div class="content-rail__main">
        <p class="text-muted">Stories from {{ town.name }} coming soon.</p>
      </div>
      <aside class="content-rail__side">
        <div class="rail-block">
          {% newsletter_signup "rail_primary" %}
        </div>
      </aside>
    </div>
  </div>
</section>
{% endif %}
{% endblock %}
